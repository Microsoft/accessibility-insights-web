# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

parameters:
    platforms: '' # electron-builder platforms, e.g. -wl for win/linux, -m for mac, etc

steps:
    - script: yarn dist:electron ${{ parameters.platforms }}
      displayName: create electron distributables

    - task: SFP.build-tasks.custom-build-task-1.EsrpCodeSigning@1
      displayName: 'ESRP CodeSigning'
      inputs:
          ConnectedServiceName: 'ESRP Code Signing'
          FolderPath: '$(System.DefaultWorkingDirectory)/dist'
          signConfigType: inlineSignParams
          inlineOperation: |
              [
                  {
                      "keyCode": "CP-401337-Apple",
                      "operationSetCode": "MacAppDeveloperSign",
                      "parameters": [],
                      "toolName": "sign",
                      "toolVersion": "1.0"
                  }
              ]

    - task: PublishBuildArtifacts@1
      inputs:
          pathtoPublish: '$(System.DefaultWorkingDirectory)/dist'
          artifactName: $(Agent.JobName)
      displayName: publish dist
