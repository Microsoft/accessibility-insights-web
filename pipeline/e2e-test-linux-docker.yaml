# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

steps:
    - script: docker build -t app .
      displayName: setup docker on linux

    - script: docker run --network=host -i app
      displayName: run e2e tests on linux

    - bash: |
          export CONTAINERID=$(docker ps -alq)
          echo "##vso[task.setvariable variable=CONTAINER_ID]$CONTAINERID"
      displayName: get container id for docker on Linux

    - script: docker cp $(CONTAINER_ID):/app/test-results/ .
      displayName: copy test results from docker to base agent

    - task: PublishTestResults@2
      inputs:
          testResultsFiles: test-results/e2e/junit-e2e.xml
          testRunTitle: accessibility-insights-web e2e
      condition: always()
      displayName: publish e2e test results

    - task: PublishBuildArtifacts@1
      inputs:
          pathtoPublish: '$(System.DefaultWorkingDirectory)/test-results/e2e'
          artifactName: 'e2e-failure-screenshots'
      condition: always()
      continueOnError: true
      displayName: publish e2e-failure-screenshots
